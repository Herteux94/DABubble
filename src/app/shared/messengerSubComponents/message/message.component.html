<div [ngClass]="ownMessage ? 'fdRowRev' : ''" class="wrapper">
  <img class="avatar" (click)="openProfileDialog()" [src]="senderAvatar" />

  <div class="text" [ngClass]="ownMessage ? 'alignFlexEnd' : ''">
    <div [ngClass]="ownMessage ? 'fdRowRev' : ''" class="nameAndTime">
      @if(this.message && this.message.senderName) {
      <span (click)="openProfileDialog()" class="name">{{
        senderName
        }}</span>

      } @if(this.message && this.message.creationTime) {
      <span class="time subText">{{
        message.creationTime.valueOf() | date : "HH:mm"
        }}</span>
      }

      <app-options-bubble (editMessage)="onEditMessageChange($event)" [messengerType]="this.messengerType"
        [message]="this.message" [ngClass]="ownMessage ? 'optionsBubbleOwnMsg' : 'optionsBubble'"
        [ownMessage]="ownMessage ? true : false"></app-options-bubble>

    </div>

    <div [ngClass]="ownMessage ? 'messageTextOwnMsg' : 'messageText'">
      <div *ngIf="message?.attachments && message.attachments.length > 0" class="fileContainer">
        <div class="filePreviewContainer">
          @for(attachment of this.message.attachments; track attachment) {
          <!-- <a (click)="openFullscreenPreview()" [href]="attachment" download class="download-link"><img [src]="attachment" alt="img file preview" -->
          <div (click)="openFullscreenPreview(attachment)"><img [src]="attachment" alt="img file preview" [ngClass]="{
                filePreview: true,
                multipleFiles: message.attachments.length > 1
              }" class="filePreview" />
          </div>}
        </div>
      </div>

      @if(this.message.content && !this.editMessage) {
      <span>{{ message.content }}</span>
      }
      @if(this.editMessage) {
      <textarea #editMsgTxtArea [(ngModel)]="this.messageContentSnapshot" class="editMsgTxtArea"></textarea>
      <div class="saveOrDiscardBtns">
        <span (click)="this.discardChanges()" class="subText">Verwerfen</span>
        <span (click)="this.saveChanges()" class="subText">Speichern</span>
      </div>
      }
    </div>

    <!-- Reaktionsbereich -->
    @if(this.message && this.message.reactions && this.message.reactions.length > 0) { <div class="reactionsArea">
      <div [ngClass]="ownMessage ? 'fdRowRev' : ''" class="reactions">
        <div class="reactionContainer">
          <img src="../../../../assets/img/close.svg" />
          <span class="reactionsCount">1</span>
        </div>
        <div class="reactionContainer">
          <img src="../../../../assets/img/google-icon.svg" />
          <span class="reactionsCount">2</span>
        </div>
      </div>
    </div>
    }

    <div *ngIf="isChannel" class="responses">
      @if(this.message && this.message.threadLength && this.message.threadLength > 0) {
      <span (click)="navigateToThread()" class="count">{{ this.message.threadLength }} Antworten</span>
      <span class="time subText">Letzte Antwort {{ this.message.lastAnswer.valueOf() | date : "HH:mm" }}</span>
      }
    </div>
  </div>
</div>